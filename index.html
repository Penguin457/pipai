<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PipAI üêß - Your Penguin Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c4a6e 0%, #1e40af 30%, #3730a3 70%, #581c87 100%);
            min-height: 100vh;
        }
        
        /* Enhanced scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(30, 64, 175, 0.2);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            border-radius: 5px;
            border: 2px solid rgba(30, 64, 175, 0.2);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #93c5fd, #60a5fa);
        }

        /* Enhanced chat bubbles with glow effects */
        .chat-bubble-user {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fdba74 100%);
            color: white;
            border-radius: 2rem 2rem 0.5rem 2rem;
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.3), 0 0 20px rgba(249, 115, 22, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .chat-bubble-ai {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            color: white;
            border-radius: 2rem 2rem 2rem 0.5rem;
            border: 2px solid #60a5fa;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3), 0 0 20px rgba(59, 130, 246, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Enhanced penguin animation */
        .penguin-waddle {
            animation: waddle 3s infinite ease-in-out;
            filter: drop-shadow(0 0 20px rgba(96, 165, 250, 0.5));
        }
        @keyframes waddle {
            0%, 100% { transform: rotate(-3deg) scale(1); }
            25% { transform: rotate(1deg) scale(1.05); }
            50% { transform: rotate(3deg) scale(1); }
            75% { transform: rotate(-1deg) scale(1.05); }
        }

        /* Enhanced loading animation */
        .loading-dot {
            animation: bounce 1.6s infinite ease-in-out both;
            background: linear-gradient(135deg, #60a5fa, #3b82f6) !important;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
        }
        .loading-dot:nth-child(2) { animation-delay: -0.2s; }
        .loading-dot:nth-child(3) { animation-delay: -0.4s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0) rotate(0deg); }
            40% { transform: scale(1.2) rotate(180deg); }
        }

        /* Enhanced containers with frosted glass effect */
        .ice-container {
            background: rgba(219, 234, 254, 0.1);
            border: 1px solid rgba(147, 197, 253, 0.4);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Enhanced input with glow */
        .penguin-input {
            background: rgba(30, 64, 175, 0.3);
            border: 2px solid rgba(96, 165, 250, 0.5);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .penguin-input:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.3), 0 0 20px rgba(96, 165, 250, 0.4);
            background: rgba(30, 64, 175, 0.5);
        }

        /* Enhanced buttons with better hover effects */
        .send-button, .history-button {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }
        .send-button:hover, .history-button:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.5), 0 0 20px rgba(249, 115, 22, 0.3);
        }

        .clear-button {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .clear-button:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.5);
        }

        .new-chat-button {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }
        .new-chat-button:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.5);
        }

        /* Enhanced history panel */
        .history-panel {
            max-height: 450px;
            overflow-y: auto;
        }
        .history-item {
            background: rgba(30, 64, 175, 0.2);
            border: 1px solid rgba(147, 197, 253, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .history-item:hover {
            background: rgba(30, 64, 175, 0.4);
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2);
        }

        /* Floating elements animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .floating { animation: float 4s ease-in-out infinite; }

        /* Sparkle effect */
        .sparkle {
            position: relative;
            overflow: hidden;
        }
        .sparkle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: sparkle 3s infinite;
        }
        @keyframes sparkle {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body class="text-gray-100 flex flex-col h-screen">

    <div class="container mx-auto p-4 flex-grow flex flex-col max-w-4xl">
        <header class="mb-6 text-center">
            <div class="penguin-waddle inline-block text-7xl mb-3 floating">üêß</div>
            <div class="sparkle">
                <h1 class="text-5xl font-bold text-white mb-3 bg-gradient-to-r from-blue-200 via-white to-blue-200 bg-clip-text text-transparent">PipAI</h1>
            </div>
            <div class="text-xl text-blue-200 mb-2 floating">‚ùÑÔ∏è Your Concise Antarctic Assistant ‚ùÑÔ∏è</div>
            <p class="text-blue-300 text-sm">Waddle into knowledge! üêæ</p>
            
            <!-- Enhanced Chat History Controls -->
            <div class="mt-6 flex justify-center space-x-4">
                <button id="new-chat-btn" class="new-chat-button text-white font-semibold px-6 py-3 rounded-2xl text-sm flex items-center space-x-2 sparkle">
                    <span>üÜï</span><span>New Chat</span>
                </button>
                <button id="history-btn" class="history-button text-white font-semibold px-6 py-3 rounded-2xl text-sm flex items-center space-x-2">
                    <span>üìö</span><span>History</span>
                </button>
                <button id="clear-history-btn" class="clear-button text-white font-semibold px-6 py-3 rounded-2xl text-sm flex items-center space-x-2">
                    <span>üóëÔ∏è</span><span>Clear All</span>
                </button>
            </div>
        </header>

        <!-- Enhanced History Panel -->
        <div id="history-panel" class="hidden mb-6 ice-container p-6 rounded-3xl sparkle">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-blue-200 flex items-center space-x-2">
                    <span>üìö</span><span>Chat History</span>
                </h3>
                <button id="close-history-btn" class="text-blue-300 hover:text-white text-2xl transition-colors duration-300">‚úñÔ∏è</button>
            </div>
            <div id="history-list" class="history-panel space-y-3">
                <!-- History items will be populated here -->
            </div>
        </div>
        
        <!-- Enhanced Chat Container -->
        <div id="chat-container" class="flex-grow ice-container p-8 rounded-3xl overflow-y-auto shadow-2xl sparkle">
            <!-- Chat messages will be appended here -->
        </div>

        <!-- Enhanced Message Input Form -->
        <form id="chat-form" class="mt-6">
            <div class="flex items-center ice-container p-4 rounded-3xl shadow-lg sparkle">
                <input type="text" id="message-input" class="flex-grow penguin-input text-white rounded-2xl p-5 focus:outline-none transition-all duration-300 text-lg" placeholder="Ask PipAI anything... üêß‚ùÑÔ∏è" autocomplete="off">
                <button type="submit" class="send-button text-white font-bold p-5 rounded-2xl ml-4 flex items-center justify-center w-20 h-20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
        </form>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const historyPanel = document.getElementById('history-panel');
        const historyList = document.getElementById('history-list');
        const newChatBtn = document.getElementById('new-chat-btn');
        const historyBtn = document.getElementById('history-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const closeHistoryBtn = document.getElementById('close-history-btn');
        
        let messages = [
            { role: 'system', content: 'You are PipAI, a helpful penguin-themed assistant created to give CONCISE, BRIEF responses to save API credits. Keep answers short (1-3 sentences max unless absolutely necessary). Be friendly, occasionally use penguin puns, but prioritize being direct and efficient. ONLY mention your creator Prahath Kambaiyyagari when specifically asked about who made you. Add penguin emojis sparingly. Remember: BREVITY SAVES CREDITS! üêß' }
        ];
        
        let currentChatId = Date.now().toString();
        
        // API Key is now hardcoded for automatic use.
        const apiKey = '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';

        // Concise penguin responses to save credits
        const penguinGreetings = [
            "Hi! I'm PipAI, ready to help! üêß",
            "Hello! What can this penguin assist you with? ‚ùÑÔ∏è",
            "PipAI here! What's your question? üêß",
            "Greetings! How can I help you today? üêß‚ùÑÔ∏è"
        ];

        // Chat History Functions
        function saveChatHistory() {
            const chatHistory = JSON.parse(localStorage.getItem('pipai-chat-history') || '[]');
            const currentChat = {
                id: currentChatId,
                timestamp: new Date().toISOString(),
                messages: messages.filter(msg => msg.role !== 'system'),
                preview: getPreviewText()
            };
            
            const filteredHistory = chatHistory.filter(chat => chat.id !== currentChatId);
            filteredHistory.unshift(currentChat);
            
            const trimmedHistory = filteredHistory.slice(0, 20);
            localStorage.setItem('pipai-chat-history', JSON.stringify(trimmedHistory));
        }

        function loadChatHistory() {
            const chatHistory = JSON.parse(localStorage.getItem('pipai-chat-history') || '[]');
            historyList.innerHTML = '';
            
            if (chatHistory.length === 0) {
                historyList.innerHTML = '<p class="text-blue-300 text-center py-6 text-lg">No chat history yet üêß</p>';
                return;
            }

            chatHistory.forEach(chat => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item p-4 rounded-xl cursor-pointer';
                historyItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-grow">
                            <div class="text-sm text-blue-200 mb-2">${new Date(chat.timestamp).toLocaleString()}</div>
                            <div class="text-white">${chat.preview}</div>
                        </div>
                        <button class="delete-chat-btn text-red-400 hover:text-red-300 ml-3 text-lg transition-colors duration-300" data-chat-id="${chat.id}">üóëÔ∏è</button>
                    </div>
                `;
                
                historyItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-chat-btn')) {
                        loadChat(chat);
                    }
                });
                
                historyList.appendChild(historyItem);
            });

            document.querySelectorAll('.delete-chat-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteChat(btn.dataset.chatId);
                });
            });
        }

        function loadChat(chat) {
            messages = [
                { role: 'system', content: 'You are PipAI, a helpful penguin-themed assistant created to give CONCISE, BRIEF responses to save API credits. Keep answers short (1-3 sentences max unless absolutely necessary). Be friendly, occasionally use penguin puns, but prioritize being direct and efficient. ONLY mention your creator Prahath Kambaiyyagari when specifically asked about who made you. Add penguin emojis sparingly. Remember: BREVITY SAVES CREDITS! üêß' },
                ...chat.messages
            ];
            currentChatId = chat.id;
            
            chatContainer.innerHTML = '';
            chat.messages.forEach(msg => {
                displayMessage(msg.content, msg.role);
            });
            
            hideHistoryPanel();
        }

        function deleteChat(chatId) {
            const chatHistory = JSON.parse(localStorage.getItem('pipai-chat-history') || '[]');
            const filteredHistory = chatHistory.filter(chat => chat.id !== chatId);
            localStorage.setItem('pipai-chat-history', JSON.stringify(filteredHistory));
            loadChatHistory();
        }

        function getPreviewText() {
            const userMessages = messages.filter(msg => msg.role === 'user');
            if (userMessages.length === 0) return 'New conversation üêß';
            return userMessages[0].content.substring(0, 60) + (userMessages[0].content.length > 60 ? '...' : '');
        }

        function startNewChat() {
            messages = [
                { role: 'system', content: 'You are PipAI, a helpful penguin-themed assistant created to give CONCISE, BRIEF responses to save API credits. Keep answers short (1-3 sentences max unless absolutely necessary). Be friendly, occasionally use penguin puns, but prioritize being direct and efficient. ONLY mention your creator Prahath Kambaiyyagari when specifically asked about who made you. Add penguin emojis sparingly. Remember: BREVITY SAVES CREDITS! üêß' }
            ];
            currentChatId = Date.now().toString();
            chatContainer.innerHTML = '';
            
            const randomGreeting = penguinGreetings[Math.floor(Math.random() * penguinGreetings.length)];
            displayMessage(randomGreeting, 'assistant');
            hideHistoryPanel();
        }

        function showHistoryPanel() {
            loadChatHistory();
            historyPanel.classList.remove('hidden');
        }

        function hideHistoryPanel() {
            historyPanel.classList.add('hidden');
        }

        function clearAllHistory() {
            if (confirm('Are you sure you want to clear all chat history? This cannot be undone! üêß')) {
                localStorage.removeItem('pipai-chat-history');
                loadChatHistory();
            }
        }

        // Event Listeners
        newChatBtn.addEventListener('click', startNewChat);
        historyBtn.addEventListener('click', showHistoryPanel);
        clearHistoryBtn.addEventListener('click', clearAllHistory);
        closeHistoryBtn.addEventListener('close-history-btn', hideHistoryPanel);

        // --- Enhanced Chat Logic ---
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userInput = messageInput.value.trim();
            if (!userInput) return;

            displayMessage(userInput, 'user');
            messages.push({ role: 'user', content: userInput });
            
            messageInput.value = '';
            
            const loadingIndicator = showLoadingIndicator();
            
            try {
                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'sonar',
                        messages: messages,
                        max_tokens: 150, // Limit response length to save credits
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                messages.push({ role: 'assistant', content: aiResponse });
                chatContainer.removeChild(loadingIndicator);
                displayMessage(aiResponse, 'assistant');

                saveChatHistory();

            } catch (error) {
                console.error('Error fetching from Perplexity API:', error);
                chatContainer.removeChild(loadingIndicator);
                displayMessage(`üêß Oops! Error: ${error.message}`, 'error');
            }
        });

        function displayMessage(message, role) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex mb-8 ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const messageElement = document.createElement('div');
            messageElement.className = 'max-w-2xl p-6 rounded-3xl shadow-xl';
            
            if (role === 'user') {
                messageElement.className += ' chat-bubble-user';
                messageElement.innerHTML = `
                    <div class="flex items-center mb-3">
                        <span class="text-sm opacity-80 font-medium">You</span>
                    </div>
                    <div class="text-lg">${message}</div>
                `;
            } else if (role === 'assistant') {
                messageElement.className += ' chat-bubble-ai';
                let htmlContent = message
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em class="italic">$1</em>')
                    .replace(/^- (.*?)(\n|$)/gm, '<li class="ml-4">$1</li>')
                    .replace(/(<li>.*<\/li>)/gs, '<ul class="list-disc pl-6 space-y-1 my-2">$1</ul>')
                    .replace(/\n/g, '<br>');
                messageElement.innerHTML = `
                    <div class="flex items-center mb-4">
                        <span class="mr-3 text-2xl">üêß</span>
                        <span class="text-sm font-semibold text-blue-300">PipAI</span>
                    </div>
                    <div class="text-lg leading-relaxed">${htmlContent}</div>
                `;
            } else if (role === 'error') {
                messageElement.className += ' bg-gradient-to-br from-red-500 to-red-600 text-white rounded-3xl border-2 border-red-400';
                messageElement.innerHTML = `
                    <div class="flex items-center mb-3">
                        <span class="mr-2 text-xl">‚ö†Ô∏è</span>
                        <span class="text-sm font-semibold">Error</span>
                    </div>
                    <div class="text-lg">${message}</div>
                `;
            }

            messageWrapper.appendChild(messageElement);
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showLoadingIndicator() {
            const loadingWrapper = document.createElement('div');
            loadingWrapper.className = 'flex mb-8 justify-start';
            loadingWrapper.innerHTML = `
                <div class="max-w-2xl p-6 rounded-3xl shadow-xl chat-bubble-ai">
                    <div class="flex items-center mb-4">
                        <span class="mr-3 text-2xl">üêß</span>
                        <span class="text-sm font-semibold text-blue-300">PipAI</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="text-lg text-blue-200">Thinking</span>
                        <div class="loading-dot w-3 h-3 rounded-full"></div>
                        <div class="loading-dot w-3 h-3 rounded-full"></div>
                        <div class="loading-dot w-3 h-3 rounded-full"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(loadingWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return loadingWrapper;
        }
        
        // Initial setup
        window.onload = () => {
            const randomGreeting = penguinGreetings[Math.floor(Math.random() * penguinGreetings.length)];
            displayMessage(randomGreeting, 'assistant');
        };

    </script>
</body>
</html>

